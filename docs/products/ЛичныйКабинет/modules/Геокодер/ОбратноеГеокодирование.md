---
id: FEA-001-001-001
title: Обратное геокодирование
description: Функция преобразования GPS координат в читаемые адреса
date: 2024-12-19
version: v1.0
status: draft
feature_id: FEA-001-001-001
type: feature
module_link: ../Геокодер.md
figma_link: https://figma.com/design/geocoding-feature
acceptance_criteria: |
  - Корректное преобразование координат в адреса с точностью до дома
  - Интеграция с DaData и Multigo API с автоматическим переключением
  - Обработка пакетных запросов до 100 координат за раз
  - Время ответа не более 5 секунд для единичного запроса
  - Обработка ошибок внешних API с fallback механизмами
author: AI Analyst
---

# Обратное геокодирование

## Цель функции

Предоставить пользователям возможность автоматического получения точных адресов по GPS координатам для улучшения качества данных о местоположении транспортных средств и оптимизации логистических процессов.

## Подробное описание функционала и бизнес-логики

### Основное назначение

Функция обратного геокодирования преобразует географические координаты (широта и долгота) в понятные пользователю адреса. Система интегрируется с внешними API геокодирования для обеспечения максимальной точности и актуальности данных.

### Техническая реализация

**Связанная техническая документация**: [POST_GetAddressesByCoordinates API](../../../technical/Identity/API/POST_GetAddressesByCoordinates.md)

Система поддерживает следующие источники данных:
- **DaData API** - приоритетный источник для российских адресов
- **Multigo API** - резервный источник с международным покрытием

### Бизнес-процессы

1. **Автоматическое определение адресов**
   - При получении GPS координат от транспортных средств
   - Автоматическое обогащение трекинговых данных
   - Формирование отчетов с читаемыми адресами

2. **Пакетная обработка координат**
   - Массовая обработка исторических данных
   - Обновление адресной информации в системе
   - Подготовка данных для аналитики

3. **Интерактивная работа пользователей**
   - Просмотр местоположения транспорта с адресами
   - Поиск и анализ маршрутов
   - Формирование отчетов для клиентов

### Алгоритм работы

```
1. Получение координат от пользователя/системы
2. Валидация формата координат
3. Определение приоритета API (по умолчанию: DaData, Multigo)
4. Параллельные запросы к выбранным API
5. Получение первого успешного ответа
6. Отмена остальных запросов
7. Нормализация и валидация результата
8. Возврат адреса пользователю
```

### Особенности обработки

**Стратегия "первый ответил"**:
- Параллельные запросы ко всем доступным API
- Использование CancellationToken для отмены неактуальных запросов
- Автоматический fallback при недоступности основного API

**Обработка ошибок**:
- Таймауты настраиваются для каждого API отдельно
- При отсутствии ответов всех API возвращается пустой результат
- Логирование всех ошибок для мониторинга качества

## Пользовательские роли и права

### Роли пользователей

1. **Диспетчер**
   - Просмотр адресов текущего местоположения ТС
   - Получение адресов для планирования маршрутов
   - Доступ к истории перемещений с адресами

2. **Аналитик**
   - Массовая обработка координат для отчетов
   - Экспорт данных с адресами
   - Анализ географического распределения событий

3. **Администратор**
   - Настройка приоритетов API
   - Мониторинг качества геокодирования
   - Управление лимитами и таймаутами

4. **Клиент (внешний API)**
   - Получение адресов через REST API
   - Пакетные запросы координат
   - Интеграция с внешними системами

### Ограничения доступа

- **Диспетчер**: только ТС своей организации
- **Аналитик**: данные в рамках доступных отчетов
- **Администратор**: полный доступ к настройкам
- **Клиент**: ограничения по rate limits

### Лимиты использования

- **Единичные запросы**: до 1000 запросов/час на пользователя
- **Пакетные запросы**: до 100 координат за раз, до 10 пакетов/час
- **API клиенты**: настраиваемые лимиты по договору

## Связанные документы

- [Техническая спецификация API](../../../technical/Identity/API/POST_GetAddressesByCoordinates.md)
- [Модуль Геокодер](../Геокодер.md)
- [Личный кабинет](../../ЛичныйКабинет.md) 